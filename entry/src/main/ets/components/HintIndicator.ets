/**
 * æç¤ºæŒ‡ç¤ºå™¨ç»„ä»¶
 * æ˜¾ç¤ºç»¿ï¼ˆä½ç½®é¢œè‰²éƒ½æ­£ç¡®ï¼‰ã€é»„ï¼ˆé¢œè‰²æ­£ç¡®ä½ç½®é”™è¯¯ï¼‰ã€ç°ï¼ˆæœªçŒœä¸­ï¼‰æç¤ºç‚¹
 *
 * æ”¯æŒä¸¤ç§æç¤ºä½ç½®ï¼š
 * - bottom: æç¤ºåœ¨å¯†ç ä¸‹æ–¹ï¼ˆç®€å•æ¨¡å¼ï¼Œå¯¹åº”æ¯ä¸ªä½ç½®ï¼Œ2x2ç½‘æ ¼ï¼‰
 * - right: æç¤ºåœ¨å³ä¾§ï¼ˆå›°éš¾æ¨¡å¼ï¼Œåªæ˜¾ç¤ºæ•°é‡ï¼Œ1x4æˆ–2x2ç½‘æ ¼ï¼‰
 *
 * æç¤ºå«ä¹‰ï¼š
 * - ğŸŸ¢ ç»¿è‰²ï¼šé¢œè‰²å’Œä½ç½®éƒ½å¯¹
 * - ğŸŸ¡ é»„è‰²ï¼šé¢œè‰²å¯¹ä½†ä½ç½®é”™
 * - âšª ç°è‰²ï¼šé¢œè‰²ä¸åœ¨å¯†ç ä¸­
 */

import { HintColors } from '../constants/Colors';
import { PositionHint } from '../services/GameService';

@Component
export struct HintIndicator {
  @Prop hits: number = 0;          // å‘½ä¸­æ•°ï¼ˆä½ç½®é¢œè‰²éƒ½å¯¹ï¼‰
  @Prop pseudoHits: number = 0;    // ä¼ªå‘½ä¸­æ•°ï¼ˆé¢œè‰²å¯¹ä½ç½®é”™ï¼‰
  @Prop positionHints?: PositionHint[];  // ä½ç½®çº§åˆ«çš„æç¤ºï¼ˆmappedæ¨¡å¼ï¼‰
  @Prop dotSize: number = 12;      // æç¤ºç‚¹å¤§å°
  @Prop maxDots: number = 4;       // æœ€å¤§æ˜¾ç¤ºç‚¹æ•°
  @Prop hintPosition: 'bottom' | 'right' = 'right';  // æç¤ºä½ç½®

  build() {
    if (this.hintPosition === 'bottom') {
      // ç®€å•æ¨¡å¼ï¼šæç¤ºåœ¨ä¸‹æ–¹ï¼Œ2x2ç½‘æ ¼ï¼Œå¯¹åº”æ¯ä¸ªä½ç½®
      Column({ space: 3 }) {
        Row({ space: 3 }) {
          ForEach([0, 1], (index: number) => {
            this.HintDot(this.getDotColorByIndex(index), index)
          })
        }
        Row({ space: 3 }) {
          ForEach([2, 3], (index: number) => {
            this.HintDot(this.getDotColorByIndex(index), index)
          })
        }
      }
      .justifyContent(FlexAlign.Center)
    } else {
      // å›°éš¾æ¨¡å¼ï¼šæç¤ºåœ¨å³ä¾§ï¼Œ2x2ç½‘æ ¼ï¼Œåªæ˜¾ç¤ºæ•°é‡
      // ä¸æŒ‰ä½ç½®æ˜¾ç¤ºï¼Œåªæ˜¾ç¤ºæ€»æ•°
      Column({ space: 3 }) {
        Row({ space: 3 }) {
          this.HintDot(this.getTotalHitColor(), 0)
          this.HintDot(this.getTotalHitColor(), 1)
        }
        Row({ space: 3 }) {
          this.HintDot(this.getTotalHitColor(), 2)
          this.HintDot(this.getTotalHitColor(), 3)
        }
      }
      .justifyContent(FlexAlign.Center)
    }
  }

  /**
   * å•ä¸ªæç¤ºç‚¹
   */
  @Builder
  HintDot(color: string, index: number) {
    Row()
      .width(this.dotSize)
      .height(this.dotSize)
      .backgroundColor(color)
      .borderRadius(this.dotSize / 2)
      .border({ width: 1, color: '#CCCCCC' })
  }

  /**
   * è·å–ç®€å•æ¨¡å¼çš„æç¤ºé¢œè‰²ï¼ˆæŒ‰ä½ç½®ï¼‰
   */
  private getDotColorByIndex(index: number): string {
    if (this.positionHints && this.positionHints[index]) {
      const hint = this.positionHints[index];
      if (hint === 'hit') {
        return '#4CAF50';  // ç»¿è‰²
      } else if (hint === 'pseudoHit') {
        return '#FFC107';  // é»„è‰²
      }
    }
    return '#E0E0E0';  // ç°è‰²/é€æ˜
  }

  /**
   * è·å–å›°éš¾æ¨¡å¼çš„æç¤ºé¢œè‰²ï¼ˆåªæ˜¾ç¤ºæ•°é‡ï¼Œä¸åŒºåˆ†ä½ç½®ï¼‰
   */
  private getTotalHitColor(): string {
    // å›°éš¾æ¨¡å¼ï¼šåªæŒ‰æ•°é‡æ˜¾ç¤ºï¼Œä¸æŒ‡æ˜å…·ä½“ä½ç½®
    // æ˜¾ç¤ºé¡ºåºï¼šç»¿è‰²å…ˆï¼Œç„¶åé»„è‰²ï¼Œæœ€åç°è‰²
    const total = this.hits + this.pseudoHits;
    const greenDots = this.hits;
    const yellowDots = this.pseudoHits;

    // è®¡ç®—å½“å‰ç´¢å¼•å¯¹åº”çš„é¢œè‰²
    if (this.hits > 0) {
      // è¿˜æœ‰ç»¿è‰²ç‚¹
      return '#4CAF50';
    } else if (this.pseudoHits > 0) {
      // è¿˜æœ‰é»„è‰²ç‚¹
      return '#FFC107';
    } else {
      // ç°è‰²
      return '#E0E0E0';
    }
  }
}
